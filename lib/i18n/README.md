# wttj-config <!-- omit in toc -->

- [Introduction](#introduction)
- [Important considerations](#important-considerations)
- [Automatic Id generation](#automatic-id-generation)
  - [Benefits](#benefits)
  - [Limitation](#limitation)
- [Contextualization](#contextualization)
- [Installation](#installation)
- [Usage](#usage)

## Introduction

i18n translations for wttj projects are based on react-intl / formatjs

Many choices have been made hand in hand with our product writer to make translations as easy as possible to use and maintain.

A core concept of this process is the automatic id generation which has its own section below. Please read it carefully.

## Important considerations

- Source locales should be in english in every projects.
- Developers are responsible for source translations (ie: `en-US.json`).
- Lokalise is responsible for target translations (ie: `fr-FR.json`, `es-ES.json`, â€¦).
- As the source locale is generated by formatjs, updates on the file will be overriden at the next extraction.
- As the target locales are proposed through pr's by lokalise, updates on these files will be overriden at the next target locale pr approval.

## Automatic Id generation

As said before, a core feature on this i18n process is based on automatic id generation. It comes with benefits as well as a limitation that you should be aware of:

### Benefits

- No need to think about choosing an id for a translation, it's automatically generated by your editor on save thanks to an eslint rule (see the [installation](#installation) section on eslintrc rule)!
- Locales are as DRY as possible, since the id is generated from the `defaultMessage` itself. Same `defaultMessage`, same id, simple as that. No common id to maintain!

### Limitation

- Product writers can't use the id to get context on the translation as it doesn't mean anything (but we have a solution for that, see [Contextualization](#contextualization) section).

## Contextualization

To help product writers have more context on the translation they are working on, we generate a `contextualized-en-US.json` file that contains a github link to the file where the translation is used in the code.

This file is then used by lokalise to provide context to the translators.

## Installation

```bash
yarn add react-intl
yarn add -D @wttj-config @formatjs/cli eslint-plugin-formatjs
```

## Usage

Create a `i18n-env` file at the root of your project with the following content:

```
APP_NAME=your-app-name // the name of your app
LOCALES_DIR_PATH=src/locales // the folder where you want your locales to be generated in
DEFAULT_LANGUAGE_FILENAME=en-US // the default language filename
EXTRACT_FROM_PATTERN=src/**/*.ts* // the global pattern where you want the scripts to look for translations
PATH_TO_IGNORE=src/admin // optional path to be ignored by the scripts
```

Then add the following scripts to your `package.json` under the `scripts` key:

```json
"i18n:extract": "export $(cat i18n-env | xargs) && formatjs extract \"$EXTRACT_FROM_PATTERN\" --ignore=\"{**/*.d.ts,$PATH_TO_IGNORE}\" --out-file $LOCALES_DIR_PATH/temp.json --flatten --format simple",
"i18n:contextualize": "export $(cat i18n-env | xargs) && node node_modules/wttj-config/lib/i18n/contextualize.mjs",
"i18n:sync": "export $(cat i18n-env | xargs) && node node_modules/wttj-config/lib/i18n/sync.mjs",
"i18n:translate": "export $(cat i18n-env | xargs) && yarn i18n:extract && yarn i18n:sync && yarn i18n:contextualize",
```

Update your `.eslintrc.cjs` configuration to include the following, under the `rules` key:

```javascript
    'formatjs/enforce-id': [
      'error',
      {
        idInterpolationPattern: '[sha512:contenthash:base64:6]',
      },
    ],
```

If you use husky, add the following line in a precommit hook `./husky/precommit` to automatize the translation process:

```shell
./node_modules/wttj-config/lib/i18n/precommit.sh
```

This should be it, enjoy and don't hesitate to reach out if you have any questions / issues!
